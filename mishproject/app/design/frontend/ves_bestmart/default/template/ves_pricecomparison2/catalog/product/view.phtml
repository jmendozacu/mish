<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); 
/*echo "<pre>+++";
print_r($_product->getData());
echo "</pre>";*/
$vendorid = $_product->getVendorId();
$price = $_product->getPrice();
$specialprice = $_product->getSpecialPrice();
$currenct_symbol= Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol();
?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>

<!-- Details page left section -->
<!-- <div class="detailspageLeft">
    <div class="product-img-box">
            <?php //echo $this->getChildHtml('media') ?>
        </div>
    <div class="clr"></div>
</div> -->
<!-- <div class="detailspageLeft">
    <div class="imagelistingLeft">
        <ul>
            <li><img src="http://localhost/mish/mishproject/media/wysiwyg/detail_printer_smallimage.jpg"></li>
            <li><img src="http://localhost/mish/mishproject/media/wysiwyg/detail_printer_smallimage.jpg"></li>
            <li><img src="http://localhost/mish/mishproject/media/wysiwyg/detail_printer_smallimage.jpg"></li>
        </ul>
    </div>
    <div class="imageRight">
        <img src="http://localhost/mish/mishproject/media/wysiwyg/detailpage_printerimage.png">
    </div>
    <div class="clr"></div>
</div> -->
<div class="detailspageLeft">
  <?php echo $this->getChildHtml('media') ?>
    <div class="clr"></div>
</div>
<!-- Details page left section -->

<!-- Details page Right section -->
<div class="detailspageRight">
    <div class="topHead">
        <h1><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h1>
        
        <ul>
            <li>    
            <span>
                    <?php 
                    $summaryData = Mage::getModel('review/review_summary')
                    ->setStoreId($storeId)
                    ->load($_product->getId());
                    $reviewCount = $summaryData['reviews_count']; 
                    $ratingSummary = $summaryData['rating_summary'];
                    $ratingNumber = (($ratingSummary*5)/100);

                    if ($summaryData['rating_summary']):?>
                    <div class="ratings">
                    <div class="rating-box">
                    <div class="rating" style="width:<?php echo $summaryData['rating_summary']; ?>%"></div>
                    </div>
                    </div>
                    <?php endif; ?>
          </span>
                    </li>
                    <li><?php echo "(".$ratingNumber.")"; ?></li>
                     <li><a href="#"><?php if($ratingSummary){echo $ratingSummary;}else{echo '0';} ?> Rating(s)</a></li>

            <li><a href="<?php echo $this->getUrl().$_product->getUrlKey().'/'.'reviews/'; ?>"><?php if($ratingSummary){echo $reviewCount;}else{echo '0';} ?> Review(s)</a></li>
           <!--  <li><a href="#">3Selfies</a></li>
            <li><a href="#">Have a question</a></li> -->
            <div class="clr"></div>
        </ul>
    </div>

    <div class="priceofferCount">
    <!-- Details Price section -->
        <div class="priceCount">

         
       
            <div class="<?php if($_product->getSpecialPrice()){
                echo 'linethroughPrice';
                }else{
                    echo 'currentPrice';
                    } 
                ?>"><?php echo $currenct_symbol." ".number_format($_product->getPrice(),2);; ?></div>
            
             <?php if($_product->getSpecialPrice()){ ?>
                <div class="currentPrice"><?php echo $currenct_symbol." ".number_format($_product->getSpecialPrice(),2); ?>
                <span>
                   <?php 
                        $originalPrice = $_product->getPrice();
                        $finalPrice = $_product->getSpecialPrice();
                        $percentage = 0;
                        if ($originalPrice > $finalPrice) {
                            $percentage = ($originalPrice - $finalPrice) * 100 / $originalPrice;
                        }

                        if ($percentage) {
                            echo $this->__($percentage . '%');
                        }
                        ?>
                </span></div>
            <?php } ?>
            <!-- Availability block , price code is commented from this block -->
            <div><?php echo $this->getChildHtml('product_type_data');?></div>
        </div>
    <!-- Details Price section -->  
    <!-- Details Offer Applicable section -->
      <!--   <div class="offerApplicable">
            <div>(2) Offers  Applicable on cart</div>
            <div class="innerCount">
                <div class="textbox">
                    <div class="left"><img src="http://localhost/mish/mishproject/media/wysiwyg/offer_icon.jpg"></div>
                    <div class="right">Get 5% instant discount + 10X rewards using Mish HDFC Bank Credit Card <a href="#">T&C</a></div>
                    <div class="clr"></div>
                </div>
                <div class="textbox borderbtmNone">
                    <div class="left"><img src="http://localhost/mish/mishproject/media/wysiwyg/offer_icon.jpg"></div>
                    <div class="right">Get 5X Reward Points Using HDFC Bank Credit Cards <a href="#">T&C</a></div>
                    <div class="clr"></div>
                </div>
            </div>
        </div> -->
    <!-- Details Offer Applicable section -->
        <div class="clr"></div>
     </div>  

        <div class="addtoCartCount">
         <?php if (!$this->hasOptions()):?>
            <?php //if($_product->isSaleable()): ?>
            <div class="buttonCount">
                <input type="button" value="add to cart" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')">
                <input type="button" value="buy now" class="color" onclick="setcheckoutLocation('<?php echo $this->getAddToCartUrl($_product) ?>','<?php echo Mage::getUrl('checkout/onepage') ?>')">
              <!--    <?php if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
                            <span class="or"><?php echo $this->__('OR') ?></span>
                        <?php endif; ?> -->
                 <?php //endif; ?>

                 <script>
                 function setcheckoutLocation(location,chkout)
                 {
                  jQuery.ajax({
                                type:"GET",
                                url:location,
                                success:function(data){
                                     window.location.href = chkout;
                                }
                             });
                }
                </script>
 <?php elseif (!$_product->isSaleable()): ?>
                <div class="add-to-box">
                    <?php echo $this->getChildHtml('addto') ?>
                </div>
            <?php endif; ?>
            </div>

        </div>

            <?php //echo $this->getTierPriceHtml() ?>
            <?php //echo $this->getChildHtml('extrahint') ?>
             <?php //echo $this->getChildHtml('other');?>

        <div class="deliveryCount">
           <?php echo $this->getChildHtml('deliverycheck');?>
        </div>
<!-- 
        <div class="p-keyfeatures kf-below-name productType">
                <ul class="clr">
                    <li class="col-xs-8 reset-padding" title="Product Type: Inkjet Printers"><span class="list-circle"></span>
                            <span class="h-content">Product Type: Inkjet Printers</span>
                       </li>
                    <li class="col-xs-8 reset-padding" title="Colour Type: Color"><span class="list-circle"></span>
                            <span class="h-content">Colour Type: Color</span>
                       </li>
                    <li class="col-xs-8 reset-padding" title="Yield (No. of Pages): 1000"><span class="list-circle"></span>
                            <span class="h-content">Yield (No. of Pages): 1000</span>
                       </li>
                    <li class="col-xs-8 reset-padding" title="Warranty: 1 Year Manufacturer Warranty"><span class="list-circle"></span>
                            <span class="h-content">Warranty: 1 Year Manufacturer Warranty</span>
                       </li>
                    <li class="col-xs-8 reset-padding" title="Utility: Home"><span class="list-circle"></span>
                            <span class="h-content">Utility: Home</span>
                       </li>
                    <li class="col-xs-8 reset-padding" title="View all item details"><span class="list-circle" style="visibility:hidden"></span>
                            <span class="h-content viewAllDetails"><a href="javascript: void(0)">View all item details</a></span>
                        </li>
                    </ul>
            </div> -->
            <div class="mispolicyDiv">
                <div class="pdp-grante-cont marT15">
                            <span class="pe-head">Mish Guarantee</span>
                            <div id="policyEngineGoldText">
                                <span class="pe-innerText" title="TrustPay : 7 Days Easy Replacements">
                                        TrustPay : 7 Days Easy Replacements</span>
                                <a class="know-more" href="https://www.snapdeal.com/page/TrustPay" target="_blank">Know More <i class="sd-icon sd-icon-next"></i></a>
                                <p class="sdGoldCont ">
                                    <i id="policyGoldIcon" class="sdGoldDeliveryIcon footerIconsImg "></i>
                                    Longer 14-days return period<span class="sdgHoverToolTip" omnisrc="sdBenefitsWidget">
                                <i class="sd-icon sd-icon-ic-more"></i>
                                </span></p>
                            </div>
                        </div>
                    </div>
</div>
<!-- Details page Right section -->
<div class="clr"></div>



<!-- Seller Details section -->
<?php 
$vendorid = $_product->getVendorId();
if($vendorid){
    $vendor_info = Mage::getModel('vendors/vendor')->load($vendorid,'vendor_id');
    $vendorName = $vendor_info->getFirstname().' '.$vendor_info->getLastname();
    $companyName = $vendor_info->getCompany();
    $cityName = $vendor_info->getCity();
    $logo = $vendor_info->getLogo();
    $vendorurlid = $vendor_info->getVendorId();

    $mediaurl = Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA);

?>
<div class="detailsmidSection">
    <div class="sellerDetails">
        <h1><?php echo __('Seller Details');  ?></h1>
        <div class="sellerInner">
            <div class="left">
                <div class="sellerImage">
                   <img src="<?php echo $mediaurl.$logo; ?>" class="img-circle" alt="Cinque Terre" width="70" height="70">
                </div>
                <div class="sellerinfo">
                    <div>
                        <span><?php echo __($vendorName); ?></span>
                <span>
                    <?php if($cityName || $companyName){
                        echo "(".$cityName;
                        if($companyName){
                            echo ",".$companyName;
                        }
                        echo ")";
                        } ?>
                </span>
                    </div>
                    <div>
                        <?php 
                             $vendorreview = Mage::getModel('vendorsreview/review')->getCollection()->addFieldToFilter('vendor_id',$vendorid);
                               foreach ($vendorreview as $vendor123) {
                                   $ratingsummary=array($vendor123['summary_percent']);
                                   $count = count($ratingsummary);
                                   $sum = array_sum($ratingsummary); 
                                 }
                                   $average = ($sum/$count);
                                   //echo "average- ".$average; 
                             ?>

                            <div class="ratings pull-left">
                                <?php if ($average):?>
                                    <div class="rating-box">
                                        <div class="rating" style="width:<?php echo ceil($average) ; ?>%;">
                                    
                                        </div>
                                    </div>
                                <?php endif;?>
                              </div>
                    </div><br>
                    <div><span id="hello" style="cursor: pointer;"><a class="view-all-reviews"><?php echo __('View Vendor Reviews'); ?></a><span id="hello" style="cursor: pointer;"></div>
                    <div><a href="#">5 more sellers starting from Rs. 2,049 </a></div>
                </div>

            </div>
            <div class="right">
                    <div class="abouttheSeller">
                        <span>About the Seller</span>
                        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, Lorem Ipsum is simply dummy text of the printing and typesetting industry. </p>
                    </div>
                  </div>  
                <div class="clr"></div>
        </div>
        <div class="visitStore">
                   <?php echo __('Expand your business to millions of customers '); ?> <a href="<?php echo $this->getUrl().'vendors/'; ?>">Sell this item on MISH</a><span><a href="<?php echo $this->getUrl().$vendorurlid; ?>">VIEW STORE</a></span>
                </div>
    </div>

    <!-- Seller Details section -->
    <?php } ?>
    <!-- Review and rating section -->
<?php //echo $this->getChildHtml('product_review'); ?>


    <div class="ratingReview customer_review">
        <h1>Ratings & Reviews</h1>

            <div class="product_review">
 <?php 
                            $summaryData = Mage::getModel('review/review_summary')
                            ->setStoreId($storeId)
                            ->load($_product->getId());
                            $reviewCount = $summaryData['reviews_count']; 
                            $ratingSummary = $summaryData['rating_summary'];
                            $ratingNumber = (($ratingSummary*5)/100); ?>
    <ul itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating">
        <li class="first  col-xs-8  leftAlignment">
                <div class="chart text">
                    <div class="rating-middle-section clearfix"> 
                        <div class="rating-text"><span class="rating"><?php echo $ratingNumber; ?></span>/5</div> 
                        <div class="rating-stars product-rating clearfix">
                           

                          <?php  

                            if ($summaryData['rating_summary']):?>
                            <div class="ratings">
                            <div class="rating-box">
                            <div class="rating" style="width:<?php echo $summaryData['rating_summary']; ?>%"></div>
                            </div>
                            </div>
                            <?php endif; ?>
                        </div>
                        <p class="total-review-txt"><?php echo $ratingSummary; ?> Rating(s) &amp; <?php echo $reviewCount; ?> Review(s) </p> 
             
                        <a href = "<?php echo $this->getUrl().$_product->getUrlKey().'/'.'reviews/'; ?>" class="view-all-reviews">View All Reviews</a>
                        </div>
                </div>
            </li>
      


            	<!-- Recommendation section starts here -->
            	 <li id="user-reviewRec-content-div" class="second col-xs-8" style="border-right: solid 1px #e8e8e8;">
                     <?php echo $this->getChildHtml('recommendation');?>
            	</li>	
            	<!-- Recommendation section ends here -->



        
        <li id="user-reviewRate-content-div" class="third col-xs-8">
            <div class="aligncenter">
                <p id="rev-text"><span>Have you used this product?</span></p>
                <a class="btn btn-orange rippleWhite js-userReviewed reviewBtn")">Review</a>
            </div>
        </li>
    </ul>
    <div class="clear"></div>
</div>

    </div>
    <!-- Review and rating section -->
<div class="clr"></div>
</div>



<!-- Model  for view all reviews starts here-->

<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h2>Customer Review</h2>
       <div class="input_search">
     <input onkeyup="searchContent();" id="searchContent" type="text" class="form-control SearchBar" placeholder="Search Customer Reviews">
     <div class="loder" id='loadingmessage' style='display:none'>
        <img src="<?php echo $this->getSkinUrl('images/loader9.gif') ?>"/>
     </div>
     <div id="suggestion"></div>
</div>
    </div>
    <div class="modal-body">
    <script type="text/javascript">
 function searchContent() {
   var value = jQuery('#searchContent').val();
    jQuery('#loadingmessage').show();
   jQuery.ajax({
           type:'POST',
           url:"<?php echo Mage::getUrl('vendorsreview/review/searchContent/');?>",
           data: {key:value},
           success:function(feedback) {
             jQuery("#suggestion").html(feedback);
              jQuery('#loadingmessage').hide();
            },
           error:function(){            
           }
               
         });
 }
</script>
 
          <?php
           
         foreach ($vendor12 as $vendor123) :
         $ratingsummary=$vendor123['summary_percent'];
         $nickname=$vendor123['nick_name'];
        $created_time=$vendor123['created_time'];
        $detail=$vendor123['detail'];   

        $words = explode(" ",$nickname );
        $acronym = "";

        foreach ($words as $w) 
        {
          $acronym .= $w[0];
        }

                                            ?>
<div class="review-main">
    <div class="review-v"><span class="review-span" style="background:#63d6d1"><?php echo ucfirst($acronym) ;?></span>
        
    </div>

    <div class="review-box">
        <div class="ratings">
            <?php if ($ratingsummary):?>
                <div class="rating-box">
                  <!--   <div class="rating" style="width:<?php echo ceil($ratingsummary) ; ?>%;">
                
                    </div> -->
                    
                </div>

            <?php endif;?>

        </div>
        <div style="margin-top: 17px;font-size: 10px; color: #999999;">
            <?php echo "by"." ".$nickname." "."on"." ".$created_time; ?>
        </div>
        <div style="margin-top: 2px; font-size: 16px; ">
            <?php echo $detail ;?>
        </div>
    </div>

</div>

    <br>
    <?php endforeach ;?> 
    </div>
   
  </div>
</div>


<!-- Model for view all reviews end here-->


<script>
// Get the modal
var modal = document.getElementById('myModal');
// Get the button that opens the modal
var btn = document.getElementById("hello");
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
// When the user clicks the button, open the modal 
btn.onclick = function() {
    modal.style.display = "block";
    return false;
}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

</script>
<style>
    .review-v{    
        float: left;
        border-radius: 45px;
        margin-right: 20px;
        margin-top: 10px;
        display: block;
    }

    .review-span{
        background: #63d6d1;
        padding: 15px;
        border-radius: 25px;
        color: #fff;
        font-size: 20px;
    }

    .review-box{
        float: left;
        margin-bottom: 28px;
    }

    .review-main{
        float: left;
        width: 100%;
    }
    .input_search
    {
      width: 217px;
    margin-left: 199px;
    margin-top: -35px;

    }
</style>



<!-- modal pop-up css-->
<style>
/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: auto;
    padding: 0;
    border: 1px solid #888;
    width: 80%;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 0.4s;
    animation-name: animatetop;
    animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
    from {top:-300px; opacity:0} 
    to {top:0; opacity:1}
}

@keyframes animatetop {
    from {top:-300px; opacity:0}
    to {top:0; opacity:1}
}

/* The Close Button */
.close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

.modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}

.modal-body {padding: 16px 16px; overflow: hidden;}


</style>
